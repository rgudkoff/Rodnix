# Архитектура RodNIX

RodNIX - это современное 64-битное ядро операционной системы, построенное с нуля для поддержки множества архитектур.

## Основные принципы

### 1. Только 64-битные архитектуры
RodNIX поддерживает только 64-битные процессоры. Это упрощает код и позволяет использовать современные возможности процессоров.

### 2. Архитектурная абстракция
Ядро разделено на архитектурно-независимые и архитектурно-зависимые части:
- **kernel/core/**: Архитектурно-независимые интерфейсы
- **kernel/arch/**: Архитектурно-зависимые реализации

### 3. Поддержка разных ISA
Ядро поддерживает как CISC (x86_64), так и RISC (ARM64, RISC-V64) архитектуры через единые интерфейсы.

## Структура проекта

```
RodNIX/
├── kernel/                    # Основное ядро
│   ├── core/                  # Архитектурно-независимые абстракции
│   │   ├── arch_types.h      # Базовые типы
│   │   ├── config.h          # Конфигурация ядра
│   │   ├── interrupts.h      # Интерфейс прерываний
│   │   ├── memory.h          # Интерфейс памяти
│   │   ├── cpu.h             # Интерфейс процессора
│   │   └── boot.h            # Интерфейс загрузки
│   ├── common/               # Общие компоненты ядра
│   │   ├── scheduler.c       # Планировщик
│   │   ├── memory.c          # Управление памятью
│   │   ├── ipc.c             # Межпроцессное взаимодействие
│   │   └── device.c          # Управление устройствами
│   └── arch/                 # Архитектурно-зависимые реализации
│       ├── x86_64/           # x86_64 (CISC)
│       │   ├── config.h
│       │   ├── types.h
│       │   ├── interrupts.c
│       │   ├── memory.c
│       │   ├── cpu.c
│       │   └── boot.S
│       ├── arm64/            # ARM64 (RISC)
│       │   └── ...
│       └── riscv64/          # RISC-V64 (RISC)
│           └── ...
├── boot/                     # Код загрузки
│   ├── boot.S               # Точка входа
│   └── ...
├── include/                  # Заголовочные файлы
│   ├── types.h              # Базовые типы
│   └── ...
└── drivers/                  # Драйверы устройств
    └── ...
```

## Архитектурные различия

### x86_64 (CISC)
- Сложные инструкции
- Переменная длина инструкций
- Много режимов адресации
- 4-уровневая страничная структура (PML4)

### ARM64 (RISC)
- Простые инструкции фиксированной длины
- Load/Store архитектура
- 4-уровневая страничная структура
- Exception Levels (EL)

### RISC-V64 (RISC)
- Минималистичный набор инструкций
- Модульная архитектура
- Страничная структура Sv39/Sv48/Sv57
- Привилегии: User, Supervisor, Machine

## Абстракции

### Прерывания
Все архитектуры используют единый интерфейс для работы с прерываниями:
- Регистрация обработчиков
- Управление уровнем прерываний (IRQL)
- IPI (Inter-Processor Interrupts)

### Память
Единый интерфейс для управления памятью:
- Отображение страниц
- Выделение/освобождение памяти
- Преобразование адресов

### Процессор
Абстракции для работы с процессором:
- Получение информации о CPU
- Переключение контекста
- Атомарные операции
- Барьеры памяти

## Преимущества архитектуры

1. **Переносимость**: Легко добавить поддержку новой архитектуры
2. **Модульность**: Четкое разделение ответственности
3. **Тестируемость**: Архитектурно-независимый код легко тестировать
4. **Поддерживаемость**: Изменения в одной архитектуре не влияют на другие

## Планы развития

- [x] Базовая структура директорий
- [ ] Реализация базовых компонентов для x86_64
- [ ] Реализация базовых компонентов для ARM64
- [ ] Реализация базовых компонентов для RISC-V64
- [ ] Планировщик задач
- [ ] Управление памятью
- [ ] IPC система
- [ ] Драйверы устройств
