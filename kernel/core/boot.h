/**
 * @file boot.h
 * @brief Архитектурно-независимый интерфейс для загрузки
 * 
 * Определяет абстракции для процесса загрузки, которые
 * реализуются в архитектурно-зависимых модулях.
 */

#ifndef _RODNIX_CORE_BOOT_H
#define _RODNIX_CORE_BOOT_H

#include "arch_types.h"
#include <stdint.h>
#include <stdbool.h>

/* ============================================================================
 * Информация о загрузке
 * ============================================================================ */

typedef struct {
    uint32_t magic;            /* Магическое число загрузчика */
    void* boot_info;           /* Информация от загрузчика */
    uint64_t mem_lower;        /* Нижняя граница памяти */
    uint64_t mem_upper;        /* Верхняя граница памяти */
    void* cmdline;             /* Командная строка */
    uint32_t flags;           /* Флаги загрузки */
} boot_info_t;

/* ============================================================================
 * Функции инициализации
 * ============================================================================ */

/**
 * Инициализация ранней загрузки
 * Выполняется до инициализации основных подсистем
 * @param info Информация от загрузчика
 * @return 0 при успехе, отрицательное значение при ошибке
 */
int boot_early_init(boot_info_t* info);

/**
 * Инициализация архитектурно-зависимых компонентов
 * Выполняется после boot_early_init
 * @return 0 при успехе, отрицательное значение при ошибке
 */
int boot_arch_init(void);

/**
 * Переход в 64-битный режим (если требуется)
 * Для архитектур, которые загружаются в 32-битном режиме
 * @return 0 при успехе, отрицательное значение при ошибке
 */
int boot_switch_to_64bit(void);

/**
 * Инициализация памяти на раннем этапе
 * Настройка базовых структур памяти до полной инициализации VMM
 * @param info Информация от загрузчика
 * @return 0 при успехе, отрицательное значение при ошибке
 */
int boot_memory_init(boot_info_t* info);

/**
 * Инициализация прерываний на раннем этапе
 * Настройка базовых обработчиков прерываний
 * @return 0 при успехе, отрицательное значение при ошибке
 */
int boot_interrupts_init(void);

/* ============================================================================
 * Утилиты
 * ============================================================================ */

/**
 * Получение информации о загрузке
 * @return Указатель на структуру с информацией о загрузке
 */
boot_info_t* boot_get_info(void);

#endif /* _RODNIX_CORE_BOOT_H */

